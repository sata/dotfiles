- name: get-nix
  get_url:
    url: https://releases.nixos.org/nix/nix-{{nix_version}}/install
    dest: /tmp/nix-install-{{nix_version}}
    mode: '0740'
- name: get-nix-signature
  get_url:
    url: https://releases.nixos.org/nix/nix-{{nix_version}}/install.asc
    dest: /tmp/nix-install-{{nix_version}}.asc
    mode: '0440'
- name: get-nix-keys
  shell: gpg2 --keyserver keyserver.ubuntu.com --recv-keys B541D55301270E0BCF15CA5D8170B4726D7198DE
- name: verify nix signature
  shell: gpg2 --verify /tmp/nix-install-{{nix_version}}.asc
- name: install nix
  shell: /tmp/nix-install-{{nix_version}}
- name: cleanup binary
  file:
    path: /tmp/nix-install-{{nix_version}}
    state: absent
- name: cleanup signature
  file:
    path: /tmp/nix-install-{{nix_version}}.asc
    state: absent
- name: add home-manager channel
  shell: nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
- name: nix-channel update
  shell: nix-channel --update
- name: install home-manager
  shell: nix-shell '<home-manager>' -A install
- name: run home manager
  shell: home-manager switch
